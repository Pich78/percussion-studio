<!-- file: src/components/RadialSoundSelector/RadialSoundSelector.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Test Harness: RadialSoundSelector</title>
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css"/>
    <!-- The menu uses the same CSS as the old component, just renamed -->
    <link rel="stylesheet" href="/percussion-studio/src/components/RadialSoundSelector/RadialSoundSelector.css">
    <style> body { font-family: sans-serif; cursor: default; } </style>
</head>
<body class="bg-light-gray pa4">

    <div class="flex">
        <div class="w-70 pr3">
            <h1 class="f2 b mb3 bb pb2">Automated Tests</h1>
            <button id="run-tests-btn" class="pv2 ph3 bn br2 bg-blue white pointer hover-bg-dark-blue mb3">Run Automated Tests</button>
            <div id="test-results"></div>
            <hr class="mv4"/>
            <h1 class="f2 b mb3 bb pb2">Live View Workbench</h1>
            
            <div class="bg-white shadow-2 pa3 mb3">
                <h3 class="f4 b mt0">Controls</h3>
                <p>Click a button to show the radial menu at a specific location with pre-defined sounds.</p>
                <div class="mb3">
                    <button id="btn-show-2" class="pv2 ph3 bn br2 bg-light-blue white pointer mr2 mb2">Show 2-Sound Menu at (300, 300)</button>
                    <button id="btn-show-3" class="pv2 ph3 bn br2 bg-teal white pointer mr2 mb2">Show 3-Sound Menu at (450, 300)</button>
                    <button id="btn-show-4" class="pv2 ph3 bn br2 bg-light-purple white pointer mr2 mb2">Show 4-Sound Menu at (600, 350)</button>
                    <button id="btn-show-5" class="pv2 ph3 bn br2 bg-purple white pointer mb2">Show 5-Sound Menu at (750, 300)</button>
                </div>
            </div>
            
            <div id="callback-log" class="f7 code pa2 bg-washed-yellow mt3 h4 overflow-y-auto">Callbacks will appear here.</div>
        </div>
        <div class="w-30 pl3">
            <div class="bg-near-black near-white pa3 br2 h-100">
                <h2 class="f4 b bb pb2 mb2">Execution Log</h2>
                <div id="log-output" class="f7 lh-copy" style="white-space: pre-wrap; height: 80vh; overflow-y: auto;"></div>
            </div>
        </div>
    </div>

    <div id="test-sandbox" style="position: absolute; visibility: hidden;"></div>

    <script type="module">
        import { run } from './RadialSoundSelector.test.js';
        import { RadialSoundSelector } from './RadialSoundSelector.js';
        import { Logger, logEvent } from '/percussion-studio/lib/Logger.js';
        
        Logger.init({ level: 'debug' });
        Logger.setTarget('log-output');

        document.getElementById('run-tests-btn').addEventListener('click', run);
        logEvent('info', 'Harness', 'setup', 'Lifecycle', 'Setting up workbench for RadialSoundSelector...');

        // --- MOCK DATA ---
        const svg1 = '<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" stroke="black" stroke-width="8" fill="none"/></svg>';
        const svg2 = '<svg viewBox="0 0 100 100"><line x1="10" y1="10" x2="90" y2="90" stroke="black" stroke-width="8"/><line x1="10" y1="90" x2="90" y2="10" stroke="black" stroke-width="8"/></svg>';
        const svg3 = '<svg viewBox="0 0 100 100"><rect x="10" y="10" width="80" height="80" stroke="black" stroke-width="8" fill="none"/></svg>';
        const svg4 = '<svg viewBox="0 0 100 100"><polygon points="50,10 90,90 10,90" stroke="black" stroke-width="8" fill="none"/></svg>';
        const svg5 = '<svg viewBox="0 0 100 100"><polygon points="50,10 90,50 50,90 10,50" stroke="black" stroke-width="8" fill="none"/></svg>';

        const twoSounds = [{letter: 'o', svg: svg1}, {letter: 'p', svg: svg2}];
        const threeSounds = [{letter: 'q', svg: svg1}, {letter: 'r', svg: svg2}, {letter: 's', svg: svg3}];
        const fourSounds = [{letter: 't', svg: svg1}, {letter: 'u', svg: svg2}, {letter: 'v', svg: svg3}, {letter: 'w', svg: svg4}];
        const fiveSounds = [{letter: 'a', svg: svg1}, {letter: 'b', svg: svg2}, {letter: 'c', svg: svg3}, {letter: 'd', svg: svg4}, {letter: 'e', svg: svg5}];
        
        const callbackLogEl = document.getElementById('callback-log');
        
        function logCallback(name, data) {
            const entry = document.createElement('div');
            entry.textContent = `[${name}] Fired with: ${JSON.stringify(data)}`;
            callbackLogEl.appendChild(entry);
            callbackLogEl.scrollTop = callbackLogEl.scrollHeight;
            logEvent('info', 'Harness', name, 'Callback', data);
        }

        // The harness (parent controller) instantiates the component ONCE
        const radialMenu = new RadialSoundSelector({
            onSoundSelected: (selectedLetter) => {
                logCallback('onSoundSelected', selectedLetter);
                // The owner is responsible for hiding the menu after a selection
                radialMenu.hide();
            }
        });

        // --- EVENT LISTENERS ---
        document.getElementById('btn-show-2').addEventListener('click', () => {
            logEvent('info', 'Harness', 'click', 'UserAction', 'Showing 2-sound menu.');
            radialMenu.show({
                x: 300, y: 300,
                sounds: twoSounds,
                activeSoundLetter: 'o'
            });
        });

        document.getElementById('btn-show-3').addEventListener('click', () => {
            logEvent('info', 'Harness', 'click', 'UserAction', 'Showing 3-sound menu.');
            radialMenu.show({
                x: 450, y: 300,
                sounds: threeSounds,
                activeSoundLetter: 'q'
            });
        });

        document.getElementById('btn-show-4').addEventListener('click', () => {
            logEvent('info', 'Harness', 'click', 'UserAction', 'Showing 4-sound menu.');
            radialMenu.show({
                x: 600, y: 350,
                sounds: fourSounds,
                activeSoundLetter: 't'
            });
        });

        document.getElementById('btn-show-5').addEventListener('click', () => {
            logEvent('info', 'Harness', 'click', 'UserAction', 'Showing 5-sound menu.');
            radialMenu.show({
                x: 750, y: 300,
                sounds: fiveSounds,
                activeSoundLetter: 'a'
            });
        });
        
        logEvent('info', 'Harness', 'setup', 'Lifecycle', 'Workbench setup complete.');
    </script>
</body>
</html>