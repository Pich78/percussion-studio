<!-- file: test/harnesses/view/TubsGridView.html (Complete, Final Version) -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Test Harness: TubsGridView</title>
<style>
body { font-family: sans-serif; display: flex; gap: 20px; padding: 20px; }
.test-panel, .live-panel, .log-panel { border: 1px solid #ccc; padding: 10px; }
.test-panel { flex: 2; }
.live-panel { flex: 2; background-color: #f0f0f0; }
.log-panel { flex: 1; background-color: #f9f9f9; }
#log-output { white-space: pre-wrap; word-wrap: break-word; font-family: monospace; font-size: 12px; }
button { font-size: 14px; padding: 8px 12px; margin: 0 5px 10px 0; }
h1, h2, h3 { border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 0; }
.controls div { margin-bottom: 10px; }

#view-container .grid {
        display: grid;
        position: relative;
    }
    #view-container .instrument-header, 
    #view-container .grid-cell {
        border-bottom: 1px solid #999;
        border-right: 1px solid #999;
        box-sizing: border-box;
    }
    #view-container .instrument-header { 
        background-color: #ddd; 
        padding: 5px; 
        cursor: pointer;
        user-select: none;
    }
    #view-container .instrument-header:hover { background-color: #ccc; }
    #view-container .grid-cell { min-height: 40px; }
    #view-container .grid-cell img { width: 100%; height: 100%; object-fit: contain; }
    
    #view-container .playback-indicator {
        position: absolute;
        top: 0;
        bottom: 0;
        background-color: rgba(255, 0, 0, 0.4);
        pointer-events: none;
        transition: left 0.05s linear;
    }
    
    #test-sandbox {
        position: absolute;
        visibility: hidden;
        pointer-events: none;
    }
</style>
</head>
<body>
<div class="test-panel">
<h1>Automated Tests</h1>
<button id="run-tests-btn">Run All Tests</button>
<div id="test-results"></div>
</div>
<div class="live-panel">
<h1>Live View Workbench</h1>
<p>Click instrument headers (KCK, SNR) to test the mute callback.</p>
<div id="view-container"></div>
<hr>
<div class="controls">
<h3>Simulate State Changes</h3>
<div>
<label for="playback-tick">Playback Tick (0-15):</label>
<input type="number" id="playback-tick" value="0" min="0" max="15">
</div>
<div>
<label for="measure-index">Measure Index (0-1):</label>
<input type="number" id="measure-index" value="0" min="0" max="1">
</div>
</div>
</div>
<div class="log-panel">
<h2>Execution Log</h2>
<pre id="log-output"></pre>
</div>

<div id="test-sandbox"></div>

<script type="module">
    import { run, manualTest } from '/percussion-studio/test/suites/view/TubsGridView.test.js';
    
    document.getElementById('run-tests-btn').addEventListener('click', () => {
        document.getElementById('test-results').innerHTML = '<h2>Running tests...</h2>';
        run();
    });

    const { view, state } = manualTest(); 
    document.getElementById('playback-tick').addEventListener('input', (e) => {
        const tick = parseInt(e.target.value, 10);
        if (!isNaN(tick)) {
            view.updatePlaybackIndicator(tick);
        }
    });

    document.getElementById('measure-index').addEventListener('input', (e) => {
        const index = parseInt(e.target.value, 10);
        if (!isNaN(index)) {
            // Create a new state object to trigger a re-render
            const newState = { ...state, currentMeasureIndex: index };
            view.render(newState);
        }
    });
</script>
</body>
</html>