<!-- file: test/harnesses/dal/DataAccessLayer.html (MODERNIZED) -->
<!DOCTYPE html>
<html lang="en">
<!-- ... (head and style sections are the same) ... -->
<body>

    <div class="main-panel">
        <h1>Test Runner for <code>DataAccessLayer.js</code></h1>
        <button id="run-tests-btn">Run All Tests</button>
        <div id="test-results"></div>
    </div>
    <div class="log-panel">
        <h2>Execution Log</h2>
        <pre id="log-output"></pre>
    </div>

<!-- file: test/harnesses/dal/DataAccessLayer.html -->
<!-- ... -->
    <script type="module">
        import { DataAccessLayer } from '/percussion-studio/src/dal/DataAccessLayer.js';
        import { runDalTests }     from '/percussion-studio/test/suites/dal/DataAccessLayer.test.js';
        import { TestRunner }      from '/percussion-studio/test/lib/TestRunner.js';
        import { MockLogger }      from '/percussion-studio/test/mocks/MockLogger.js';

        // Make the class under test available globally for the test suite.
        window.DataAccessLayer = DataAccessLayer;

        document.getElementById('run-tests-btn').addEventListener('click', async () => {
            const resultsContainer = document.getElementById('test-results');
            resultsContainer.innerHTML = '<h2>Running tests...</h2>';
            
            MockLogger.clearLogs();
            MockLogger.setLogTarget('log-output');

            const runner = new TestRunner();
            
            // 1. This function now just queues up all the tests. It returns instantly.
            runDalTests(runner);

            // 2. This NEW line waits for all the queued tests to actually finish.
            await runner.awaitForAll();

            // 3. NOW we can safely render the results.
            runner.renderResults('test-results');
        });
    </script>
<!-- ... -->
</body>
</html>